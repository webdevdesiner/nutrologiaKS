/*
 * HTML5 File Upload
 * By STBeets
 * Purchase on http://codecanyon.net/item/html5-file-upload/9254506?ref=stbeets
 * Version 1.4.2
 */
function empty(e){var i,t,n,a,l=[i,null,!1,0,"","0"];for(n=0,a=l.length;a>n;n++)if(e===l[n])return!0;if("object"==typeof e){for(t in e)return!1;return!0}return!1}function randString(e){e||(e=8);for(var i="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;e>n;n++)i+=t.charAt(Math.floor(Math.random()*t.length));return i}!function(e,i){"use strict";i.html5fileupload=function(t,n){this.element=i(n),this.options=i.extend(!0,{},i.html5fileupload.defaults,t,i(this.element).data()),this.input=i(this.element).find("input[type=file]");var a=(i(e),this);this.button={},this.button.edit='<div class="btn btn-info edit"><i class="glyphicon glyphicon-pencil"></i></div>',this.button.start='<div class="btn btn-success start"><i class="glyphicon glyphicon-play" title="Enviar arquivo"></i></div>',this.button.restart='<div class="btn btn-success restart"><i class="glyphicon glyphicon-repeat"></i></div>',this.button.cancel='<div class="btn btn-danger cancel"><i class="glyphicon glyphicon-ban-circle"></i></div>',this.button.reset='<div class="btn btn-warning reset"><i class="glyphicon glyphicon-refresh"></i></div>',this.button.remove='<div class="btn btn-danger remove"><i class="glyphicon glyphicon-remove" title="Remover arquivo"></i></div>',this.button.done='<div class="btn btn-success done"><i class="glyphicon glyphicon-ok"></i></div>',this.button.del='<div class="btn btn-danger del"><i class="glyphicon glyphicon-trash"></i></div>',this.button.download='<a class="btn btn-warning download"><i class="glyphicon glyphicon-download" title="Baixar arquivo"></i></a>',this.button.allstart='<div class="btn btn-success allstart"><i class="glyphicon glyphicon-play-circle" title="Enviar todos uploads"></i> '+(this.options.labelAllStart||"")+"</div>",this.button.allstop='<div class="btn btn-warning allstop"><i class="glyphicon glyphicon-record"></i> '+(this.options.labelAllStop||"")+"</div>",this.button.alldone='<div class="btn btn-info alldone"><i class="glyphicon glyphicon-ok-circle"></i> '+(this.options.labelAllDone||"")+"</div>",this.button.allremove='<div class="btn btn-danger allremove"><i class="glyphicon glyphicon-remove-circle" title="Remover todos uploads"></i> '+(this.options.labelAllRemove||"")+"</div>",this.progressbar='<div class="progress"><div class="progress-bar progress-bar-success progress-bar-striped"></div></div>',this.files=[],this.xhrPool=[],a._init()},i.html5fileupload.defaults={showErrors:!1,url:null,downloadUrl:null,removeUrl:null,removeDone:!1,removeDoneDelay:1200,file:null,edit:!0,randomName:!1,randomNameLength:8,form:!1,data:{},ajax:!0,ajaxType:"POST",ajaxDataType:"json",ajaxHeaders:{},multiple:!1,validExtensions:null,validMime:null,labelInvalid:null,autostart:!1,minFilesize:0,maxFilesize:2048e3,labelMinFilesize:null,labelMaxFilesize:null,regexp:/^[^\\/:\*\?"<>\|]+$/},i.html5fileupload.prototype={_init:function(){var e=this,t=e.options,n=e.element,a=e.input;if(e.options.validExtensions=empty(t.validExtensions)?null:t.validExtensions.split(","),0!=t.multiple&&0==t.ajax&&alert("This option is not valid! NOT TO BE IMPLEMENTED ERROR"),0!=t.multiple){a.attr("multiple","multiple").wrap('<div class="add"></div>'),n.addClass("empty");var l=i("<div></div>").addClass("multiple").hide(),s=i(e.button.allstart).unbind("click").hide().click(function(){e.startAll()}),o=i(e.button.allstop).unbind("click").hide().click(function(){e.stopAll()}),d=i(e.button.alldone).unbind("click").hide().click(function(){e.removeDone()}),r=i(e.button.allremove).unbind("click").click(function(){e.removeAll()});l.append(s).append(d).append(o).append(r),n.append(l)}empty(t.file)||(i.each(t.file.split(","),function(t,n){var a=n.split("/"),l={};l.name=a[a.length-1],l.size=0,l.type=null,l.original=n;var s=e.addFile(l,!0);i(s).data("server-file",n)}),0==t.multiple&&i(a).hide()),t.form&&i(n).closest("form").keypress(function(e){return 13==e.keyCode&&1==i(e.target).data("rename")?!1:void 0}),e._bind()},_bind:function(){var e=this,t=e.element,n=e.input,a=e.options;a.form?i(t).find("input[type=file]").change(function(t){e.handleFile(t,i(this))}):(i(t).unbind("dragover").unbind("drop").unbind("mouseout").on({dragover:function(i){e.handleDrag(i)},drop:function(t){e.handleFile(t,i(this))},mouseout:function(){}}),i(n).unbind("change").change(function(n){e.drag=!1,e.handleFile(n,i(t))}))},handleFile:function(e,t){e.stopPropagation(),e.preventDefault();var n=this,a=n.options,l=n.input,s=0==n.drag?e.originalEvent.target.files:a.form?i(t)[0].files:e.originalEvent.dataTransfer.files;n.drag=!1;for(var o,d=0;(o=s[d])&&(n.addFile(o),1==a.multiple);d++);1!=a.form&&n._resetInput(),0==a.multiple&&i(l).hide()},handleDrag:function(e){var i=this;i.drag=!0,e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},addFile:function(e,t){var n=this,a=n.element,l=n.options,s=n.input,o=n.calcSize(e.size),d=i("<div></div>").addClass("file"),r=e.name.split(".").pop(),p=e.name.substr(0,e.name.length-r.length-1);if(empty(l.validExtensions)||-1!=i.inArray(r,l.validExtensions))if(empty(l.validMime)||e.type.match(l.validMime))if(null!=l.minFilesize&&l.minFilesize>0&&e.size<l.minFilesize){var c=n.calcSize(l.minFilesize);d.append(i("<div></div>").html(e.name).addClass("name")),d.append(i("<div></div>").html(l.labelMinFilesize||"File is smaller then the minimum filesize ("+c.size+" "+c.label+")").addClass("notvalid")),d.append(i(n.progressbar).hide());var u=i(n.button.remove).addClass("remove").unbind("click").click(function(){n.remove(i(this).closest(".file"))});d.prepend(i("<div></div>").addClass("pull-right tools").append(u)),n.element.append(d)}else if(null!=l.maxFilesize&&l.maxFilesize>0&&e.size>l.maxFilesize){var f=n.calcSize(l.maxFilesize);d.append(i("<div></div>").html(e.name).addClass("name")),d.append(i("<div></div>").html(l.labelMaxFilesize||"O arquivo Ã© maior que o permitido ("+f.size+" "+f.label+")").addClass("notvalid")),d.append(i(n.progressbar).hide());var u=i(n.button.remove).addClass("remove").unbind("click").click(function(){n.remove(i(this).closest(".file"))});d.prepend(i("<div></div>").addClass("pull-right tools").append(u)),n.element.append(d)}else{i(a).find(".multiple").show();var h=!1;if(0!=l.multiple&&n.files.length>0)for(var v,m=0;v=n.files[m];m++)if(e.name==v.name&&e.size==v.size&&e.type==v.type){h=m;break}if(h!==!1)return i(i(a).find(".file").get(h)).addClass("double").delay(500).queue(function(){i(this).removeClass("double").clearQueue()}),this;var b=i("<div></div>").addClass("inner"),g=null,y=0;if(!empty(e.type)&&e.type.match("image.*")){g=i("<div></div>").addClass("preview"),d.prepend(g);var x=new FileReader;x.onload=function(e){return function(i){g.css("background-image","url("+i.target.result+")").attr("title",e.name)}}(e),x.readAsDataURL(e),y-=i(g).outerWidth()+10}if(1==l.randomName&&t!==!0&&(p=randString(l.randomNameLength)),b.append(i("<div></div>").html(p+"."+r).addClass("name")),b.append(i("<div></div>").html(o.size+" "+o.label).addClass("size")),d.append(b),d.append(i("<div></div>").addClass("clearfix")),n.element.append(d),t===!0){d.data("done",!0);var w=i("<div></div>").addClass("pull-right tools"),C=i(n.button.del).unbind("click").click(function(){n.removeFile(i(this).closest(".file"))});0!=l.buttonDel&&w.append(C),d.prepend(w),y-=i(w).outerWidth(),-1!==i.inArray(r,["jpg","jpeg","png","gif","bmp"])&&(g=i("<div></div>").addClass("preview"),g.css("background-image","url("+e.original+")"),d.prepend(g),y-=i(g).outerWidth()+10)}else{if(1==l.edit){var k=i("<input />").attr({type:"text",name:i(s).attr("name")+"_name"}).data("rename",!0).val(p).addClass("form-control").keyup(function(e){e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),i(this).parent().removeClass("has-error"),13==e.keyCode?n.editDone(i(this).closest(".file")):27==e.keyCode&&n.editCancel(i(this).closest(".file"))}),F=i("<div></div>").html("."+r).addClass("extension").css({marginTop:-Math.round(k.height()/2)});b.append(i("<div></div>").append(k).append(F).addClass("input").hide())}else 0==l.edit&&1==l.form&&b.append(i("<input />").attr({type:"text",name:i(s).attr("name")+"_name"}).val(p).hide());b.append(i(n.progressbar).hide());var z=i(n.button.start).unbind("click").click(function(){n.start(i(this).closest(".file"))}),u=i(n.button.remove).unbind("click").click(function(){n.remove(i(this).closest(".file"))}),E=i(n.button.edit).unbind("click").click(function(){n.edit(i(this).closest(".file"))}),w=i("<div></div>").addClass("pull-right tools");0==l.buttonStart||l.form||w.append(z),0!=l.buttonEdit&&1==l.edit&&w.append(E),0!=l.buttonRemove&&w.append(u),d.prepend(w),y-=i(w).outerWidth(),l.autostart&&w.children().hide(),i(a).find(".multiple .allstart").show();var A=n.files.push(e)-1}g&&(y-=i(g).outerWidth()),y+=i(d).outerWidth(),i(b).css({width:y}),d.data({originalFilename:p,filename:p,extension:r,file:e.name,index:A}),l.autostart&&t!==!0&&n.start(i(d))}else{d.append(i("<div></div>").html(e.name).addClass("name")),d.append(i("<div></div>").html(l.labelInvalid||"File is not valid").addClass("notvalid")),d.append(i(n.progressbar).hide());var u=i(n.button.remove).addClass("remove").unbind("click").click(function(){n.remove(i(this).closest(".file"))});d.prepend(i("<div></div>").addClass("pull-right tools").append(u)),n.element.append(d)}else{d.append(i("<div></div>").html(e.name).addClass("name")),d.append(i("<div></div>").html(l.labelInvalid||"File is not valid").addClass("notvalid")),d.append(i(n.progressbar).hide());var u=i(n.button.remove).addClass("remove").unbind("click").click(function(){n.remove(i(this).closest(".file"))});d.prepend(i("<div></div>").addClass("pull-right tools").append(u)),n.element.append(d)}return d},removeFile:function(e){var t=this,n=t.options;e.find(".tools").hide(),i.ajax({url:n.removeUrl,type:n.ajaxType||"POST",dataType:n.ajaxDataType||"json",data:{file:e.data("file")},headers:n.ajaxHeaders}).done(function(a){1==a.result?t.remove(e):(1==n.showErrors&&(e.find(".error").remove(),e.find(".inner").append(i('<div class="error text-danger"></div>').html("<strong>Error</strong>: "+ +a.status+" "+a.statusText))),e.find(".tools").show())}).fail(function(t){1==n.showErrors&&(e.find(".e rror").remove(),e.find(".inner").append(i('<div class="error text-danger"></div>').html("<strong>Error</strong>: "+ +t.status+" "+t.statusText))),e.find(".tools").show()})},calcSize:function(e){if(0==e)return{size:"",label:""};for(var i=["Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],t=0,n=e/1024;n>1e3;n/=1e3,t++);return{size:n.toFixed(2),label:i[t]}},startAll:function(){var e=this,t=(e.options,e.input,e.element),n=(e.files,t.find(".file")),a=i(t).find(".multiple");i(a).find(".allstart").hide(),i(a).find(".allstop").show();for(var l,s=0;l=n[s];s++)e.start(i(l));var o=setInterval(function(){empty(e.xhrPool)&&(i(a).find(".allstart").show(),i(a).find(".allstop").hide(),clearInterval(o))},1e3)},stopAll:function(){var e=this,t=e.element;i(e.xhrPool).each(function(e,i){i.abort()}),e.xhrPool.length=0;var n=i(t).find(".multiple");i(n).find(".allstart").show(),i(n).find(".allstop").hide()},removeDone:function(){var e=this,t=e.element;i.each(t.find(".file"),function(t,n){i(n).data("done")===!0&&e.remove(i(this))})},start:function(t,n){var a=this,l=a.options,s=(a.input,a.element),o=a.files;if(n=o[t.data("index")],t.data("done")===!0)return this;var d=t.find(".progress").show();i(d).find(".progress-bar").removeClass("progress-bar-info progress-bar-danger").addClass("active progress-bar-success").css("width","0%"),t.find(".tools").children().hide();var r=new FileReader;r.onloadend=function(n){var o=i.ajax({url:l.url,dataType:l.ajaxDataType||"json",type:l.ajaxType||"POST",cache:!1,data:{name:t.data("filename"),filename:t.data("file"),file:n.target.result,data:l.data},headers:l.ajaxHeaders,xhr:function(){var t=new e.XMLHttpRequest;return t.upload.addEventListener("progress",function(e){e.lengthComputable&&i(d).find(".progress-bar").css("width",Math.round(e.loaded/e.total*100)+"%")},!1),t},beforeSend:function(e){a.xhrPool.push(e),t.find(".tools").append(i(a.button.cancel).click(function(){o.abort()}))}}).done(function(e){1==e.result?(i(d).find(".progress-bar").removeClass("active progress-bar-success").addClass("progress-bar-info").css("width","100%"),t.find(".tools").empty(),t.data("done",!0),1==l.removeDone?setTimeout(function(){a.remove(t)},l.removeDoneDelay):(i(s).find(".multiple .alldone").show(),0!=l.buttonDownload&&t.find(".tools").append(i(a.button.download).attr({download:(l.downloadUrl||l.url)+"?"+t.data("file"),href:(l.downloadUrl||l.url)+"?"+t.data("file")})),0!=l.buttonDone&&t.find(".tools").append(i(a.button.done).click(function(){a.remove(t)}))),a.options.onAfterStartSuccess&&a.options.onAfterStartSuccess.call(a,e)):(1==l.showErrors&&(t.find(".error").remove(),t.find(".inner").append(i('<div class="error text-danger"></div>').html("<strong>Error</strong>: "+ +e.status+" "+e.statusText))),i(d).find(".progress-bar").removeClass("active progress-bar-success").addClass("progress-bar-danger").css("width","100%"),t.find(".tools").empty().append(i(a.button.restart).click(function(){a.start(t)})).append(i(a.button.remove).click(function(){a.remove(t)})),a.options.onAfterStartFail&&a.options.onAfterStartFail.call(a,e))}).fail(function(e){1==l.showErrors&&(t.find(".error").remove(),t.find(".inner").append(i('<div class="error text-danger"></div>').html("<strong>Error</strong>: "+ +e.status+" "+e.statusText))),i(d).find(".progress-bar").removeClass("active progress-bar-success").addClass("progress-bar-danger").css("width","100%"),t.find(".tools").empty().append(i(a.button.restart).click(function(){a.start(t)})).append(i(a.button.remove).click(function(){a.remove(t)})),a.options.onAfterStartFail&&a.options.onAfterStartFail.call(a,e)}).complete(function(e){var i=a.xhrPool.indexOf(e);i>-1&&a.xhrPool.splice(i,1),a.options.onAfterStartAlways&&a.options.onAfterStartAlways.call(a,response)})},r.readAsDataURL(n)},edit:function(e){var t=this,n=(t.options,t.button);e.find(".inner").children().hide(),e.find(".input").show(),e.find(".input input").val(e.data("filename")).focus(),e.find(".tools").children().toggle();var a=i(n.done).unbind("click").click(function(){t.editDone(e)}),l=i(n.cancel).unbind("click").click(function(){t.editCancel(e)}),s=i(n.reset).unbind("click").click(function(){t.editReset(e)});return e.find(".tools").append(a).append(l).append(s),t},editDone:function(e){var i=this,t=i.options,n=e.find(".input input").val(),a=/^\./;return!t.regexp.test(n)||a.test(n)?(e.find(".input").addClass("has-error"),this):(e.find(".tools").children(":visible").remove(),e.find(".tools").children().toggle(),e.find(".input").hide(),e.find(".name").show().html(e.find(".input input").val()+"."+e.data("extension")),e.find(".size").show(),e.data("filename",e.find(".input input").val()),this)},editCancel:function(e){e.find(".tools").children(":visible").remove(),e.find(".tools").children().toggle(),e.find(".input").hide(),e.find(".name").show(),e.find(".size").show()},editReset:function(e){e.find(".tools").children(":visible").remove(),e.find(".tools").children().toggle(),e.find(".input").hide(),e.find(".name").show().html(e.data("originalFilename")+"."+e.data("extension")),e.find(".size").show(),e.data("filename",e.data("originalFilename"))},remove:function(e){{var t=this,n=t.element;t.input}e.remove(),0==i(n).find(".file").length&&t.reset()},removeAll:function(){var e=this,t=e.element;i.each(i(t).find(".file"),function(t,n){i(n).data("done")===!0?e.removeFile(i(n)):e.remove(i(n))})},reset:function(){var e=this,t=e.element,n=e.input;e.files=[],e._resetInput(),e.stopAll(),i(t).children().not(n).not(".add").not(".multiple").remove();var a=i(t).find(".multiple").hide();i(a).find(".allstart").hide(),i(a).find(".allstop").show()},_resetInput:function(){var e=this,t=e.input;i(t).wrap("<form>").parent("form").trigger("reset"),i(t).unwrap("<form>").show()}},i.fn.html5fileupload=function(e){return i.data(this,"html5fileupload")?void 0:i(this).each(function(){new i.html5fileupload(e,this),i.data(this,"html5fileupload")})}}(window,jQuery);